CalculateKPIRequest:
  type: object
  required:
    - upload_id
  properties:
    upload_id:
      type: string
      format: uuid
      description: Reference to uploaded financial data file
      example: c2383c43-9c58-4034-a878-ae7db9a09f0d

UploadSummary:
  type: object
  required:
    - overall_status
    - total_files
    - processed_files
    - failed_files
  properties:
    overall_status:
      type: string
      description: Overall status of the upload processing
      enum:
        - success
        - partial
        - failed
      example: success
    total_files:
      type: integer
      description: Total number of files in the upload
      example: 1
      minimum: 0
    processed_files:
      type: integer
      description: Number of successfully processed files
      example: 1
      minimum: 0
    failed_files:
      type: integer
      description: Number of failed files
      example: 0
      minimum: 0
    timestamp:
      type: string
      format: date-time
      description: Timestamp of processing
      example: "2025-12-09T14:57:17.938993"

FailedFileInfo:
  type: object
  required:
    - filename
    - error
  properties:
    filename:
      type: string
      description: Name of the failed file
      example: invalid_format.xlsx
    error:
      type: string
      description: Error message explaining the failure
      example: Invalid spreadsheet format

CalculatedKPI:
  type: object
  required:
    - kpi_id
    - kpi_name
    - kpi_category
    - kpi_value
    - calculation_status
    - error_message
    - dependencies_satisfied
    - calculation_duration_ms
    - calculation_order
    - last_calculation_date
    - created_at
    - updated_at
  properties:
    kpi_id:
      type: string
      format: uuid
      description: Unique KPI identifier
      example: f951c880-91dd-486a-884e-4e16a064f65b
    kpi_name:
      type: string
      description: Human-readable name of the KPI
      example: Net Income
      minLength: 1
      maxLength: 255
    kpi_category:
      type: string
      description: Category classification of the KPI
      enum:
        - Dependency Metric
        - Profitability
        - Liquidity
        - Solvency
        - Growth Metrics
        - Efficiency Metrics
      example: Profitability
    kpi_value:
      type: number
      description: Calculated value of the KPI (can be integer or decimal)
      example: 790000.0
    calculation_status:
      type: string
      description: Status of KPI calculation
      enum:
        - calculated
        - pending
        - failed
      example: calculated
    error_message:
      type: string
      nullable: true
      description: Error message if calculation failed (null if successful)
      example: null
    dependencies_satisfied:
      type: boolean
      description: Whether all required dependencies for this KPI are satisfied
      example: true
    calculation_duration_ms:
      type: integer
      description: Time taken to calculate this KPI in milliseconds
      example: 64
      minimum: 0
    calculation_order:
      type: integer
      description: Order in which KPI was calculated (for dependency resolution)
      example: 0
      minimum: 0
    last_calculation_date:
      type: string
      format: date-time
      description: Timestamp of last calculation
      example: "2025-12-09T14:57:17.938993"
    created_at:
      type: string
      format: date-time
      description: Timestamp when KPI record was created
      example: "2025-12-09T14:57:18.004140"
    updated_at:
      type: string
      format: date-time
      description: Timestamp of last update
      example: "2025-12-09T14:57:18.004143"

HistoricalKPI:
  type: object
  required:
    - id
    - upload_id
    - file_id
    - kpi_name
    - kpi_category
    - period_start_date
    - period_end_date
    - period_type
    - period_label
    - kpi_value
    - calculation_status
    - error_message
    - created_at
    - updated_at
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for this historical KPI record
      example: 7631de9b-c2b0-4d82-87c3-f65dd37f575f
    upload_id:
      type: string
      format: uuid
      description: Reference to the upload batch
      example: 21c2e0e0-11bb-4810-a8a8-8a40aac71045
    file_id:
      type: string
      format: uuid
      description: Reference to the specific file within the upload
      example: 180df6c1-a073-42ab-8d92-397b5e71727a
    kpi_name:
      type: string
      description: Human-readable name of the KPI
      example: Net Income
      minLength: 1
      maxLength: 255
    kpi_category:
      type: string
      description: Category classification of the KPI
      enum:
        - Dependency Metric
        - Profitability
        - Liquidity
        - Solvency
        - Growth Metrics
        - Efficiency Metrics
      example: Dependency Metric
    period_start_date:
      type: string
      format: date
      description: Start date of the period for this KPI value
      example: "2021-01-01"
    period_end_date:
      type: string
      format: date
      description: End date of the period for this KPI value
      example: "2021-12-31"
    period_type:
      type: string
      description: Type of the time period
      enum:
        - yearly
        - quarterly
        - monthly
        - weekly
        - daily
      example: yearly
    period_label:
      type: string
      description: Human-readable label for the period
      example: "2021"
      minLength: 1
      maxLength: 50
    kpi_value:
      type: number
      description: Historical value of the KPI for this period
      example: 150000.0
    calculation_status:
      type: string
      description: Status of KPI calculation
      enum:
        - calculated
        - pending
        - failed
      example: calculated
    error_message:
      type: string
      nullable: true
      description: Error message if calculation failed (null if successful)
      example: null
    created_at:
      type: string
      format: date-time
      description: Timestamp when this historical record was created
      example: "2025-12-11T16:54:47.810129"
    updated_at:
      type: string
      format: date-time
      description: Timestamp of last update to this record
      example: "2025-12-11T16:54:47.810130"
  
ColumnRelation:
  type: object
  description: Column relations grouped by file ID
  additionalProperties:
    type: object
    required:
      - file_name
      - file_type
      - sheets
    properties:
      file_name:
        type: string
        description: Name of the uploaded file
        example: income-statement-(1)-with-1-sheet.xlsx
        minLength: 1
      file_type:
        type: string
        description: Type of the financial statement file
        enum:
          - income_statement
          - balance_sheet
          - cash_flow
          - unknown
        example: unknown
      sheets:
        type: object
        description: Sheet-level data containing column relations
        additionalProperties:
          type: object
          required:
            - columns_relation_detected
            - periods
            - columns_relation
          properties:
            columns_relation_detected:
              type: boolean
              description: Whether column relations were detected in this sheet
              example: true
            periods:
              type: array
              description: List of time periods found in the data
              items:
                type: string
              example:
                - "2020"
                - "2019"
              minItems: 1
            columns_relation:
              type: array
              description: Array of parent-child relationships between line items
              items:
                $ref: "#/ColumnRelation"
              minItems: 0
  example:
    "24dcbc7b-af30-49ab-84f6-4cdcbf9f2460":
      file_name: income-statement-(1)-with-1-sheet.xlsx
      file_type: unknown
      sheets:
        SingleStep:
          columns_relation_detected: true
          periods:
            - "2020"
            - "2019"
          columns_relation:
            - parent: Total Revenue
              children:
                - Sales revenue
                - Service revenue
              children_value:
                - "2020": 110000.0
                  "2019": 95000.0
                - "2020": 70000.0
                  "2019": 62000.0



KPICalculationResponse:
  type: object
  required:
    - message
    - upload_id
    - total_kpis
    - calculated_kpis
  properties:
    message:
      type: string
      description: Status message
      example: Successfully retrieved KPIs
    upload_id:
      type: string
      format: uuid
      description: Reference to the uploaded file
      example: c2383c43-9c58-4034-a878-ae7db9a09f0d
    total_kpis:
      type: integer
      description: Total number of KPIs calculated
      example: 17
      minimum: 0
    calculated_kpis:
      type: array
      description: Array of calculated KPI objects
      items:
        $ref: "#/CalculatedKPI"
    historical_kpis:
      type: array
      description: Array of historical KPI values for trend analysis
      items:
        $ref: "#/HistoricalKPI"

KPIPartialResponse:
  type: object
  required:
    - upload_summary
    - failed_files
  properties:
    upload_summary:
      $ref: "#/UploadSummary"
    failed_files:
      type: array
      description: Information about files that failed processing
      items:
        $ref: "#/FailedFileInfo"

KPIRetrievalResponse:
  type: object
  required:
    - message
    - upload_id
    - total_kpis
    - calculated_kpis
    - historical_kpis
    - columns_relation
  properties:
    message:
      type: string
      description: Status message
      example: Successfully retrieved KPIs
    upload_id:
      type: string
      format: uuid
      description: Upload identifier
      example: c2383c43-9c58-4034-a878-ae7db9a09f0d
    total_kpis:
      type: integer
      description: Total number of KPIs retrieved
      example: 17
      minimum: 0
    calculated_kpis:
      type: array
      description: Array of calculated KPI objects with full metadata
      items:
        $ref: "#/CalculatedKPI"
    historical_kpis:
      type: array
      description: Array of historical KPI values for trend analysis
      items:
        $ref: "#/HistoricalKPI"
    columns_relation:
      type: array
      description: Array of Income Statement columns relation 
      items:
        $ref: "#/ColumnRelation"


